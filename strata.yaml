# Generated by Spice version: 15.0.1 at Thu Nov 30 2023
global:
  jenkins-environment: true # adds useful environment variables to your builds
  email-reply-to: mcn@salesforce.com
  email-only-last-committer-on-dev-branch: true
  mc-artifactory-publishing: true # MC specific feature flag to enable handling artifact replication to 1P
  production-branches:
    - main
    - r:^prerelease/.+ # allows for using SNAPSHOT versioning on branches following this pattern
stages:
  precheck:
    - step:
        name: mcn-ci-precheck  # MCN commands to prepare your builds for SFCI
        image: docker.repo.local.sfdc.net/sfci/gec/sfdc-mc-mj/dockimg.docker-mcn-ci/build-artifacts/sfmc-mcn-ci:latest
        commands:
          # provides useful version information when debugging your build
          - mcn-ci-launch mcn-ci-version
          # ensures your talon manifest is correctly formatted
          - mcn-ci-launch spice lint-manifest
          # modifies current build to work in SFCI and handles Prerelease branch logic
          - mcn-ci-launch mc-sfci-bootstrap
  package:
    - docker-build:
        images:
          - dockerfile: image/.operations/sfci.Dockerfile
            image-name: build-artifacts/sfmc-fluent-bit
            build-context: image
    - step:
        name: mcn-ci-tag
        image: docker.repo.local.sfdc.net/sfci/gec/sfdc-mc-mj/dockimg.docker-mcn-ci/build-artifacts/sfmc-mcn-ci:latest
        environment:
          # inject the value from the Strata pipeline to support tagging logic for MCN applications
          - name: IS_PRODUCTION_BRANCH
        commands:
          # creates git tags on Production based on the version specified in the Talon Manifest
          # or uses a SNAPSHOT version if on a Prerelease Branch
          - mcn-ci-launch mc-sfci-git-tag
  publish:
    - docker-push
